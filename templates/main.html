<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>SQLite DB Editor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <h1>üî• SQLite Editor ‚Äî Obsidian & Scarlet üî•</h1>
    </header>

    <div class="container glass">
        <div class="top-bar">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ .db -->
            <form id="uploadForm" method="POST" action="/load_db" enctype="multipart/form-data">
                <label class="upload-area" id="drop-area">
                    –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ .db —Å—é–¥–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ
                    <input type="file" name="file" id="fileElem" accept=".db" onchange="document.getElementById('uploadForm').submit()">
                    <span class="btn" onclick="document.getElementById('fileElem').click()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å .db</span>
                </label>
            </form>

            <!-- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –±–∞–∑—ã -->
            <a href="/download_db" class="btn">üíæ –°–∫–∞—á–∞—Ç—å .db</a>
        </div>

        <hr>

        <div class="main-section">
            <div class="left-panel">
                <h2>üì¶ –¢–∞–±–ª–∏—Ü—ã</h2>
                <div class="table-list">
                    {% for table in tables %}
                        <a class="btn small table-link" href="?table={{ table }}">{{ table }}</a>
                    {% endfor %}
                </div>

                <hr>
                <h3>üß± –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</h3>
                <form method="POST" action="/create_table">
                    <input name="table_name" placeholder="–ò–º—è —Ç–∞–±–ª–∏—Ü—ã" required>
                    <textarea name="columns" placeholder="id INTEGER PRIMARY KEY, name TEXT" required></textarea>
                    <button class="btn small" type="submit">–°–æ–∑–¥–∞—Ç—å</button>
                </form>
            </div>

            <div class="right-panel">
                {% if selected_table %}
                    <h2>üîß –¢–∞–±–ª–∏—Ü–∞: {{ selected_table }}</h2>
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    {% for col in columns %}
                                        <th>{{ col }}</th>
                                    {% endfor %}
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in rows %}
                                <tr>
                                    <form method="POST" action="/update/{{ selected_table }}/{{ row[0] }}">
                                        <td>{{ row[0] }}</td>
                                        {% for i in range(columns|length) %}
                                            <td><input name="{{ columns[i] }}" value="{{ row[i+1] }}"></td>
                                        {% endfor %}
                                        <td>
                                            <button type="submit" class="btn small">üíæ</button>
                                            <a class="btn small red" href="/delete/{{ selected_table }}/{{ row[0] }}">–£–¥–∞–ª–∏—Ç—å</a>
                                        </td>
                                    </form>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</h3>
                    <form method="POST" action="/add/{{ selected_table }}">
                        {% for col in columns %}
                            <input name="{{ col }}" placeholder="{{ col }}">
                        {% endfor %}
                        <button type="submit" class="btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </form>
                {% endif %}

                <div class="sql-block">
                    <h2>üß† SQL-–∑–∞–ø—Ä–æ—Å</h2>
                    <form id="queryForm">
                        <textarea name="query" placeholder="SELECT * FROM users;"></textarea>
                        <button class="btn" type="submit">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                    </form>

                    <div id="terminal"></div>
                </div>
            </div>
        </div>

        <div class="help-toggle">
            <button class="btn small" onclick="toggleHelp()">‚Ñπ –ü–æ–º–æ—â—å</button>
        </div>

        <div class="help-section" id="helpSection" style="display: none;">
            <h2>‚Ñπ –ü–æ–º–æ—â—å</h2>
            <ul>
                <li>üîß <b>–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü</b>: <code>id INTEGER PRIMARY KEY, name TEXT</code></li>
                <li>üì• <b>–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã</b>: –≤—ã–±–µ—Ä–∏ .db –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏</li>
                <li>üìù <b>–†–µ–¥–∞–∫—Ç–∏—Ä—É–π</b> ‚Üí –Ω–∞–∂–∏–º–∞–π üíæ</li>
                <li>üß† <b>SQL-–∑–∞–ø—Ä–æ—Å—ã</b>: <code>SELECT * FROM users;</code></li>
            </ul>
        </div>
    </div>

    <footer>
        <p>¬© 2025 dyeness</p>
    </footer>

    <script>
    const dropArea = document.getElementById("drop-area");
    const uploadForm = document.getElementById("uploadForm");
    const fileElem = document.getElementById("fileElem");

    dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.classList.add("dragover");
    });

    dropArea.addEventListener("dragleave", () => {
        dropArea.classList.remove("dragover");
    });

    dropArea.addEventListener("drop", (e) => {
        e.preventDefault();
        dropArea.classList.remove("dragover");
        fileElem.files = e.dataTransfer.files;
        uploadForm.submit();
    });

    function toggleHelp() {
        const help = document.getElementById("helpSection");
        help.style.display = (help.style.display === "none") ? "block" : "none";
    }

    // –¢–µ—Ä–º–∏–Ω–∞–ª SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (AJAX)
    const form = document.getElementById('queryForm');
    const terminal = document.getElementById('terminal');
    form.addEventListener('submit', function (e) {
        e.preventDefault();
        const data = new FormData(form);
        fetch('/query', {
            method: 'POST',
            body: data
        }).then(res => res.json()).then(res => {
            if (res.error) {
                terminal.innerHTML = `<pre class="error-terminal">–û—à–∏–±–∫–∞: ${res.error}</pre>`;
            } else if (res.result && res.result.length > 0) {
                terminal.innerHTML = `<pre>${JSON.stringify(res.result, null, 2)}</pre>`;
            } else {
                terminal.innerHTML = `<pre>‚úÖ –£—Å–ø–µ—à–Ω–æ</pre>`;
            }
        }).catch(err => {
            terminal.innerHTML = `<pre class="error-terminal">–û—à–∏–±–∫–∞: ${err}</pre>`;
        });
    });
    </script>
</body>
</html>
